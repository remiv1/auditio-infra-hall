<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Hall</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>

    <div class="header">
        <h1>üîß Administration Hall</h1>
        <span>LAN Only</span>
        <button onclick="reloadConfig()" class="btn-reload">üîÑ Recharger config</button>
        <a href="{{ url_for('admin_bp.admin_logout') }}" class="btn-logout" style="float:right;margin-left:1em;">D√©connexion</a>
    </div>

    <h2>üåê Domaines configur√©s</h2>
    <div style="margin-bottom:1rem;">
        <a href="{{ url_for('admin_bp.admin_testing') }}" class="btn-add">Configuration</a>
    </div>
    <table>
        <thead>
            <tr>
                <th>Domaine</th>
                <th>Description</th>
                <th>IP Serveur</th>
                <th>Politique</th>
                <th>Timeout</th>
                <th>Statut</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for name, data in domains.items() %}
            <tr>
                <td><a href="/{{ name }}">{{ name }}</a></td>
                <td>{{ data.config.description or '-' }}</td>
                <td>{{ data.config.server.ip }}</td>
                <td>
                    <span class="badge badge-policy">{{ data.config.policy.type }}</span>
                </td>
                <td>{{ data.config.policy.idle_timeout_minutes }} min</td>
                <td>
                    <span class="status-dot {{ 'online' if data.online else 'offline' }}"></span>
                    {{ 'En ligne' if data.online else 'Hors ligne' }}
                </td>
                <td>
                    {% if data.config.shutdown_endpoint %}
                    <form action="{{ url_for('admin_bp.shutdown_server', domain=name) }}" method="post" style="display:inline;" onsubmit="return confirm('√âteindre le serveur {{ name }} ?');">
                        <button type="submit" class="btn-delete">√âteindre</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" style="text-align: center; color: #888;">Aucun domaine configur√©</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>‚ö° Activit√© r√©cente</h2>
    <table>
        <thead>
            <tr>
                <th>Domaine</th>
                <th>Derni√®re activit√©</th>
                <th>Dernier WoL</th>
                <th>Nb r√©veils</th>
            </tr>
        </thead>
        <tbody>
            {% for act in activity %}
            <tr>
                <td>{{ act.domain }}</td>
                <td>{{ act.last_activity }}</td>
                <td>{{ act.last_wol or '-' }}</td>
                <td>{{ act.boot_count }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" style="text-align: center; color: #888;">Aucune activit√©</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>üìã Derniers logs</h2>
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Domaine</th>
                <th>Action</th>
                <th>Statut</th>
                <th>IP Client</th>
                <th>D√©tails</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>{{ log.timestamp }}</td>
                <td>{{ log.domain }}</td>
                <td>{{ log.action }}</td>
                <td>
                    <span class="badge badge-{{ 'success' if log.status == 'success' else 'failed' if log.status == 'failed' else 'pending' }}">
                        {{ log.status or '-' }}
                    </span>
                </td>
                <td><code>{{ log.client_ip or '-' }}</code></td>
                <td>{{ log.details or '-' }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" style="text-align: center; color: #888;">Aucun log</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
